<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dashboard – Ledgerdaddy</title>
  <meta name="theme-color" content="#1A237E" />
  <link rel="preconnect" href="https://images.unsplash.com" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Brand palette (requested)
    tailwind.config = {
      theme: {
        extend: {
          colors:{
            indigoDeep:"#1A237E",
            emerald:"#2E7D32",
            cyanBright:"#00BCD4",
            accentOrange:"#FF7043",
            brandBg:"#F9FAFB",
            brandBorder:"#E5E7EB",
            brandMuted:"#6B7280",
            brandPrimary:"#111827"
          },
          boxShadow:{
            lift:"0 16px 40px rgba(17,24,39,.08)"
          },
          borderRadius:{ xl2:"14px" },
          backgroundImage:{
            "soft-gradient":"linear-gradient(135deg, #EFF6FF 0%, #FFFFFF 100%)",
            "brand-header":"linear-gradient(90deg, #1A237E 0%, #00BCD4 100%)",
            "tile-calc":"linear-gradient(135deg, rgba(26,35,126,.08) 0%, rgba(0,188,212,.14) 100%)",
            "tile-hs":"linear-gradient(135deg, rgba(46,125,50,.08) 0%, rgba(0,188,212,.12) 100%)",
            "tile-market":"linear-gradient(135deg, rgba(255,112,67,.10) 0%, rgba(0,188,212,.12) 100%)",
            "tile-chat":"linear-gradient(135deg, rgba(26,35,126,.10) 0%, rgba(46,125,50,.12) 100%)",
            "cta-grad":"linear-gradient(90deg, #00BCD4 0%, #2E7D32 100%)"
          }
        }
      }
    }
  </script>
  <style>
    /* ---- Base UI ---- */
    body{background:#F9FAFB}
    .card{ @apply rounded-2xl p-6 bg-white border border-brandBorder shadow-md transition-transform duration-150; }
    .card:hover{ @apply -translate-y-0.5 shadow-lg; }
    .focus-ring:focus-visible{ @apply outline-none ring-2 ring-cyanBright ring-offset-2; }
    .btn{ @apply inline-flex items-center gap-2 px-4 py-2 rounded-xl font-semibold transition will-change-transform; }
    .btn-primary{ background:var(--btn-bg, linear-gradient(90deg,#00BCD4,#2E7D32)); color:#fff; }
    .btn-primary:hover{ transform:translateY(-1px); }
    .btn-outline{ @apply border border-brandBorder bg-white text-brandPrimary; }
    .badge{ @apply text-[11px] px-2 py-0.5 rounded-full border border-cyanBright/40 text-cyanBright; }

    /* Ripple (click feedback) */
    .ripple{ position:relative; overflow:hidden; }
    .ripple:after{
      content:""; position:absolute; inset:auto; width:0; height:0; border-radius:50%;
      background:rgba(0,188,212,.25); transform:translate(-50%,-50%);
      pointer-events:none; transition:width .35s ease,height .35s ease,opacity .5s ease;
      opacity:0;
    }
    .ripple:active:after{
      left:var(--x); top:var(--y); width:180px; height:180px; opacity:1;
      transition:0s;
    }

    /* Tooltips (for truncated/extra info) */
    [data-tooltip]{ position:relative; }
    [data-tooltip]:hover::after{
      content:attr(data-tooltip); position:absolute; left:50%; transform:translateX(-50%);
      bottom:calc(100% + 8px); white-space:nowrap; background:#111827; color:#fff;
      font-size:12px; padding:6px 8px; border-radius:8px; box-shadow:0 8px 20px rgba(0,0,0,.12);
      z-index:50;
    }

    /* Active nav pill/underline */
    .nav-link{ @apply text-sm font-medium px-3 py-2 rounded-lg transition relative text-white/90; }
    .nav-link:hover{ @apply bg-white/10 text-white; }
    .nav-link[aria-current="page"]{ @apply text-white bg-white/15; }
    .nav-link[aria-current="page"]::after{
      content:""; position:absolute; left:12px; right:12px; bottom:6px; height:2px; background:#00BCD4; border-radius:999px;
    }

    /* Horizontal pinned tool card */
    .tool{ @apply border border-brandBorder rounded-2xl p-4 flex items-center gap-4 bg-white hover:shadow-lg transition; }
    .tool:hover .pin-btn{ opacity:1; transform:translateY(0); }
    .pin-btn{ @apply opacity-0 -translate-y-0.5 transition; }
  </style>
</head>
<body class="min-h-screen text-brandPrimary">
  <!-- ===== Auth gate ===== -->
  <script>
    (function(){
      try{
        const u = JSON.parse(localStorage.getItem('chadaddy_user')||'null');
        if(!u || !u.email){ window.location.replace('/log-in.html'); }
      }catch(e){ window.location.replace('/log-in.html'); }
    })();
  </script>

  <!-- ===== Sticky Gradient Header ===== -->
  <header class="fixed top-0 inset-x-0 z-50 border-b border-white/10 bg-brand-header backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3 text-white" aria-label="Home">
        <span class="grid h-9 w-9 place-items-center rounded-xl bg-white/10 font-extrabold shadow">◆</span>
        <span class="text-xl font-bold">Ledgerdaddy</span>
        <span class="ml-2 hidden sm:inline-flex badge border-white/40 text-white/90">AI Customs</span>
      </a>

      <nav class="hidden md:flex items-center gap-1">
        <a href="/marketplace.html" class="nav-link flex items-center gap-2">
          <!-- store icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90"><path d="M3 9h18M4 9l2-5h12l2 5M5 9v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Marketplace
        </a>
        <a href="/calculator.html" class="nav-link flex items-center gap-2">
          <!-- calculator icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90"><rect x="4" y="3" width="16" height="18" rx="2" stroke="currentColor" stroke-width="1.6"/><path d="M8 7h8M8 12h0M12 12h0M16 12h0M8 16h0M12 16h0M16 16h0" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
          Calculator
        </a>
        <a href="/hs-finder.html" class="nav-link flex items-center gap-2">
          <!-- search icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
          HS Finder
        </a>
        <a href="/chat.html" class="nav-link flex items-center gap-2">
          <!-- chat icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" class="opacity-90"><path d="M21 12a8 8 0 1 1-3.1-6.3L21 6v6z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Chat
        </a>
      </nav>

      <div class="flex items-center gap-2">
        <div class="relative group">
          <button class="btn btn-primary ripple text-sm focus-ring" id="accountBtn">Account ▾</button>
          <div class="absolute right-0 mt-2 hidden group-hover:block bg-white border border-brandBorder rounded-xl shadow-lg w-48">
            <a href="/profile.html" class="block px-4 py-2 text-sm hover:bg-brandBg">Profile</a>
            <a href="/security.html" class="block px-4 py-2 text-sm hover:bg-brandBg">Security & Privacy</a>
            <a href="/payments.html" class="block px-4 py-2 text-sm hover:bg-brandBg">Payment Methods</a>
            <a href="/integrations.html" class="block px-4 py-2 text-sm hover:bg-brandBg">Integrations</a>
            <button id="logoutBtn" class="w-full text-left block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Sign out</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== Page Header ===== -->
  <section class="pt-24 md:pt-28">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex items-center justify-between gap-3 flex-wrap">
        <div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
            Welcome, <span id="name">there</span> 👋
          </h1>
          <p class="text-brandMuted mt-2 text-sm md:text-base">Quick access to your tools and recent activity.</p>
        </div>
        <div class="flex items-center gap-2">
          <a href="/chat.html" class="btn btn-primary ripple focus-ring" style="--btn-bg:var(--btn-bg,linear-gradient(90deg,#00BCD4,#2E7D32))">Ask something</a>
          <a href="/calculator.html" class="btn btn-outline focus-ring">New estimate</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Metrics Row (scorecards) ===== -->
  <section class="max-w-7xl mx-auto px-4 mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
    <div class="card">
      <div class="text-xs uppercase text-brandMuted">Saved Estimates</div>
      <div class="mt-1 flex items-baseline gap-2">
        <div class="text-3xl md:text-4xl font-extrabold tracking-tight">3</div>
        <span class="text-xs text-brandMuted">total</span>
      </div>
    </div>
    <div class="card">
      <div class="text-xs uppercase text-brandMuted">HS Codes Searched</div>
      <div class="mt-1 flex items-baseline gap-2">
        <div class="text-3xl md:text-4xl font-extrabold tracking-tight">12</div>
        <span class="text-xs text-brandMuted">this month</span>
      </div>
    </div>
    <div class="card">
      <div class="text-xs uppercase text-brandMuted">Invoices Sent</div>
      <div class="mt-1 flex items-baseline gap-2">
        <div class="text-3xl md:text-4xl font-extrabold tracking-tight">5</div>
        <span class="text-xs text-brandMuted">last 7 days</span>
      </div>
    </div>
    <div class="card">
      <div class="text-xs uppercase text-brandMuted">Chat Threads</div>
      <div class="mt-1 flex items-baseline gap-2">
        <div id="kpiThreads" class="text-3xl md:text-4xl font-extrabold tracking-tight">0</div>
        <span class="text-xs text-brandMuted">active</span>
      </div>
    </div>
  </section>

  <!-- ===== Content Grid ===== -->
  <main id="main" class="max-w-7xl mx-auto px-4 mt-8 grid gap-6 lg:grid-cols-[1.2fr,0.8fr]">
    <!-- Left column -->
    <div class="grid gap-6">
      <!-- Quick Actions as big tiles -->
      <section class="card">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold">Quick actions</h2>
          <div class="text-xs text-brandMuted">Common tasks</div>
        </div>

        <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
          <!-- Calculator -->
          <a href="/calculator.html" class="group rounded-2xl p-5 bg-tile-calc border border-brandBorder hover:scale-105 hover:shadow-xl transition focus-ring ripple">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg grid place-items-center bg-white/70">
                <!-- calc icon -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><rect x="4" y="3" width="16" height="18" rx="2" stroke="#1A237E" stroke-width="1.6"/><path d="M8 7h8M8 12h0M12 12h0M16 12h0M8 16h0M12 16h0M16 16h0" stroke="#1A237E" stroke-width="1.6" stroke-linecap="round"/></svg>
              </div>
              <div>
                <div class="text-sm font-semibold">Open Calculator</div>
                <div class="text-xs text-brandMuted">Start a new estimate</div>
              </div>
            </div>
          </a>

          <!-- HS Finder -->
          <a href="/hs-finder.html" class="group rounded-2xl p-5 bg-tile-hs border border-brandBorder hover:scale-105 hover:shadow-xl transition focus-ring ripple">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg grid place-items-center bg-white/70">
                <!-- search icon -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="#2E7D32" stroke-width="1.6"/><path d="M20 20l-3.5-3.5" stroke="#2E7D32" stroke-width="1.6" stroke-linecap="round"/></svg>
              </div>
              <div>
                <div class="text-sm font-semibold">HS Finder</div>
                <div class="text-xs text-brandMuted">Get code suggestions</div>
              </div>
            </div>
          </a>

          <!-- Marketplace -->
          <a href="/marketplace.html" class="group rounded-2xl p-5 bg-tile-market border border-brandBorder hover:scale-105 hover:shadow-xl transition focus-ring ripple">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg grid place-items-center bg-white/70">
                <!-- store icon -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 9h18M4 9l2-5h12l2 5M5 9v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9" stroke="#FF7043" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div>
                <div class="text-sm font-semibold">Find Broker</div>
                <div class="text-xs text-brandMuted">Compare verified CHAs</div>
              </div>
            </div>
          </a>

          <!-- Chat -->
          <a href="/chat.html" class="group rounded-2xl p-5 bg-tile-chat border border-brandBorder hover:scale-105 hover:shadow-xl transition focus-ring ripple">
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-lg grid place-items-center bg-white/70">
                <!-- chat icon -->
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M21 12a8 8 0 1 1-3.1-6.3L21 6v6z" stroke="#00BCD4" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </div>
              <div>
                <div class="text-sm font-semibold">Ask in Chat</div>
                <div class="text-xs text-brandMuted">ChatGPT-style helper</div>
              </div>
            </div>
          </a>
        </div>
      </section>

      <!-- Pinned Tools as horizontal cards -->
      <section class="card">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold">Pinned tools</h2>
        </div>

        <div class="mt-4 grid gap-4">
          <!-- Tool row -->
          <article class="tool">
            <div class="h-11 w-11 rounded-xl grid place-items-center bg-soft-gradient">
              <!-- calc -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><rect x="4" y="3" width="16" height="18" rx="2" stroke="#1A237E" stroke-width="1.6"/></svg>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <h3 class="font-semibold text-sm md:text-base truncate" title="Calculator">Calculator</h3>
                <span class="badge">Last used 2 days ago</span>
              </div>
              <p class="text-sm text-brandMuted truncate" data-tooltip="Estimate BCD, IGST/VAT and landed cost.">
                Estimate BCD, IGST/VAT and landed cost.
              </p>
            </div>
            <div class="flex items-center gap-2">
              <a href="/calculator.html" class="btn btn-outline text-sm focus-ring">Open →</a>
              <button class="pin-btn btn btn-outline text-sm focus-ring" data-pin="calculator" aria-pressed="true" title="Unpin">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="text-amber-500"><path d="M14 3l7 7-4 1-1 4-7-7 4-1 1-4zM3 21l7-7" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </article>

          <article class="tool">
            <div class="h-11 w-11 rounded-xl grid place-items-center bg-soft-gradient">
              <!-- hs -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="7" stroke="#2E7D32" stroke-width="1.6"/></svg>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <h3 class="font-semibold text-sm md:text-base truncate" title="HS Finder">HS Finder</h3>
                <span class="badge">Last used 4 days ago</span>
              </div>
              <p class="text-sm text-brandMuted truncate">Describe product → get HS suggestions.</p>
            </div>
            <div class="flex items-center gap-2">
              <a href="/hs-finder.html" class="btn btn-outline text-sm focus-ring">Open →</a>
              <button class="pin-btn btn btn-outline text-sm focus-ring" data-pin="hs" aria-pressed="true" title="Unpin">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M14 3l7 7-4 1-1 4-7-7 4-1 1-4zM3 21l7-7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </article>

          <article class="tool">
            <div class="h-11 w-11 rounded-xl grid place-items-center bg-soft-gradient">
              <!-- market -->
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 9h18M4 9l2-5h12l2 5M5 9v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V9" stroke="#FF7043" stroke-width="1.6"/></svg>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2">
                <h3 class="font-semibold text-sm md:text-base truncate" title="Marketplace">Marketplace</h3>
                <span class="badge">Last used 1 week ago</span>
              </div>
              <p class="text-sm text-brandMuted truncate">Browse & compare verified customs brokers.</p>
            </div>
            <div class="flex items-center gap-2">
              <a href="/marketplace.html" class="btn btn-outline text-sm focus-ring">Open →</a>
              <button class="pin-btn btn btn-outline text-sm focus-ring" data-pin="market" aria-pressed="false" title="Pin">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M14 3l7 7-4 1-1 4-7-7 4-1 1-4zM3 21l7-7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              </button>
            </div>
          </article>
        </div>
      </section>

      <!-- Recent items -->
      <section class="card">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold">Recent items</h2>
          <div class="text-xs text-brandMuted">Demo</div>
        </div>
        <ul id="recentList" class="mt-3 grid gap-3 text-sm"></ul>
      </section>
    </div>

    <!-- Right column -->
    <aside class="grid gap-6">
      <!-- Account -->
      <section class="card">
        <h3 class="text-lg font-bold">Account</h3>
        <dl class="mt-3 text-sm">
          <div class="flex justify-between py-2 border-b border-brandBorder/60">
            <dt class="text-brandMuted">Email</dt>
            <dd id="email" class="font-medium">—</dd>
          </div>
          <div class="flex justify-between py-2 border-b border-brandBorder/60">
            <dt class="text-brandMuted">Member since</dt>
            <dd id="memberSince" class="font-medium">—</dd>
          </div>
        </dl>
        <button id="clearData" class="mt-4 text-xs underline text-cyanBright">Clear local data</button>
      </section>

      <!-- What's next as progress tracker -->
      <section class="card">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-bold">What’s next?</h3>
          <div class="w-28 h-2 bg-brandBorder/60 rounded-full overflow-hidden">
            <div id="progressBar" class="h-full bg-[linear-gradient(90deg,#00BCD4,#2E7D32)]" style="width: 40%"></div>
          </div>
        </div>

        <ul class="mt-3 space-y-3 text-sm">
          <li class="flex items-start gap-3">
            <span class="mt-0.5 inline-flex h-5 w-5 rounded-full bg-emerald text-white items-center justify-center">✓</span>
            <div>Complete your profile</div>
          </li>
          <li class="flex items-start gap-3">
            <span class="mt-0.5 inline-flex h-5 w-5 rounded-full border border-brandBorder items-center justify-center">2</span>
            <div>Create a landed cost estimate in the <a class="text-cyanBright underline" href="/calculator.html">Calculator</a></div>
          </li>
          <li class="flex items-start gap-3">
            <span class="mt-0.5 inline-flex h-5 w-5 rounded-full border border-brandBorder items-center justify-center">3</span>
            <div>Try <a class="text-cyanBright underline" href="/hs-finder.html">HS Finder</a> with a product description</div>
          </li>
          <li class="flex items-start gap-3">
            <span class="mt-0.5 inline-flex h-5 w-5 rounded-full border border-brandBorder items-center justify-center">4</span>
            <div>Browse verified brokers in the <a class="text-cyanBright underline" href="/marketplace.html">Marketplace</a></div>
          </li>
        </ul>

        <div class="mt-4 flex gap-2">
          <a href="/calculator.html" class="btn btn-primary ripple focus-ring">→ Create Estimate</a>
          <a href="/chat.html" class="btn btn-outline focus-ring">Ask a question</a>
        </div>
      </section>
    </aside>
  </main>

  <footer class="text-center text-xs text-brandMuted mt-10 mb-8">
    © <span id="year"></span> Ledgerdaddy
  </footer>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Session → header name/email/memberSince
    let user = null;
    try{ user = JSON.parse(localStorage.getItem('chadaddy_user')||'null'); }catch(e){}
    if(user){
      document.getElementById('name').textContent = user.name || 'there';
      document.getElementById('email').textContent = user.email || '—';
      const d = new Date(user.ts || Date.now());
      document.getElementById('memberSince').textContent = d.toLocaleDateString();
    }

    // Demo recent list
    const recent = [
      { t:'Estimate • IN • HS 851713 • CIF', time:'2 days ago', link:'/calculator.html' },
      { t:'HS Finder • “LED downlight”', time:'4 days ago', link:'/hs-finder.html' },
      { t:'Broker shortlist • JNPT', time:'1 week ago', link:'/marketplace.html' },
      { t:'Chat • “Docs for EU furniture”', time:'1 week ago', link:'/chat.html' },
    ];
    document.getElementById('recentList').innerHTML = recent
      .map(r => `<li class="border border-brandBorder rounded-xl px-3 py-2 flex items-center justify-between">
        <a class="hover:text-cyanBright truncate" href="${r.link}" title="${r.t}">${r.t}</a>
        <span class="text-brandMuted">${r.time}</span></li>`).join('');

    // Chat threads KPI
    try{
      const t = JSON.parse(localStorage.getItem('ld_chat_threads_v1')||'[]');
      const n = Array.isArray(t) ? t.length : 0;
      document.getElementById('kpiThreads').textContent = n;
      // simple progress calc
      const pb = document.getElementById('progressBar');
      if(pb) pb.style.width = Math.min(100, 20 + n*10) + '%';
    }catch{}

    // Logout
    document.getElementById('logoutBtn')?.addEventListener('click', () => {
      localStorage.removeItem('chadaddy_user');
      window.location.replace('/log-in.html');
    });

    // Clear demo data
    document.getElementById('clearData')?.addEventListener('click', () => {
      localStorage.removeItem('chadaddy_user');
      localStorage.removeItem('ld_chat_threads_v1');
      alert('Local demo data cleared. You may need to sign in again.');
    });

    // Active nav highlight
    const path = location.pathname.replace(/\/+$/, '');
    document.querySelectorAll('nav a.nav-link').forEach(a => {
      const href = a.getAttribute('href');
      if (href && path.endsWith(href.replace(/\/+$/,''))) {
        a.setAttribute('aria-current','page');
      }
    });

    // Pin/unpin buttons (localStorage state)
    const PIN_KEY = 'ld_pins_v1';
    const pins = new Set(JSON.parse(localStorage.getItem(PIN_KEY)||'[]'));
    document.querySelectorAll('[data-pin]').forEach(btn => {
      const key = btn.dataset.pin;
      const pressed = pins.has(key);
      btn.setAttribute('aria-pressed', pressed ? 'true' : 'false');
      btn.addEventListener('click', () => {
        const nowPressed = btn.getAttribute('aria-pressed') !== 'true';
        btn.setAttribute('aria-pressed', nowPressed ? 'true' : 'false');
        if(nowPressed) pins.add(key); else pins.delete(key);
        localStorage.setItem(PIN_KEY, JSON.stringify([...pins]));
      });
    });

    // Ripple coordinates
    document.body.addEventListener('mousedown', (e) => {
      const t = e.target.closest('.ripple');
      if(!t) return;
      const rect = t.getBoundingClientRect();
      t.style.setProperty('--x', (e.clientX - rect.left) + 'px');
      t.style.setProperty('--y', (e.clientY - rect.top) + 'px');
    });
  </script>
</body>
</html>
