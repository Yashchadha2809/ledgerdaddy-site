<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign up ‚Äì Chadaddy</title>
  <meta name="theme-color" content="#2563EB" />
  <link rel="preconnect" href="https://images.unsplash.com" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors:{
            brandPrimary:"#111827",
            brandAccent:"#2563EB",
            brandSoft:"#EFF6FF",
            brandBorder:"#E5E7EB",
            brandMuted:"#6B7280",
            brandBg:"#F9FAFB"
          },
          boxShadow:{ lift:"0 10px 25px rgba(17,24,39,.10)" }
        }
      }
    }
  </script>
  <style>
    .card{transition:transform .12s ease, box-shadow .2s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 14px 34px rgba(17,24,39,.12)}
    .hero-img{background:url('https://images.unsplash.com/photo-1586521995568-39ef16c6934d?q=80&w=1920&auto=format&fit=crop') center/cover no-repeat;}
  </style>

  <!-- Supabase JS v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // üîß Supabase config (VALUES MUST BE IN QUOTES)
    const PROJECT_URL = "https://nkvrhaxpoehqcgoamjhq.supabase.co";
    const ANON_KEY   = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5rdnJoYXhwb2VocWNnb2FtamhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU3OTc5MDcsImV4cCI6MjA3MTM3MzkwN30.I6azwaIiEsQ_EjFRXtIZFTvpcc_g6NccsC3pJdWQPks";

    // Create client (sessions persist in localStorage)
    const supabase = window.supabase.createClient(PROJECT_URL, ANON_KEY, {
      auth: { persistSession: true, storage: window.localStorage }
    });

    // Optional: quick console sanity check
    console.log("Supabase URL:", PROJECT_URL);
    console.log("Anon key starts with:", ANON_KEY.slice(0, 10));
  </script>
</head>
<body class="bg-brandBg text-brandPrimary">

  <!-- Topbar (matches home) -->
  <header class="fixed top-0 inset-x-0 z-50 border-b border-brandBorder bg-white/90 backdrop-blur">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="flex items-center gap-2" aria-label="Home">
        <span class="grid h-9 w-9 place-items-center rounded-xl bg-gradient-to-tr from-brandSoft to-white text-brandPrimary font-extrabold shadow">‚óÜ</span>
        <span class="text-xl font-bold">Chadaddy</span>
        <span class="ml-2 hidden sm:inline-flex text-[11px] px-2 py-0.5 rounded-full border border-brandBorder text-brandMuted">AI Customs</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm font-medium" aria-label="Main">
        <a href="/#marketplace" class="hover:text-brandAccent">Marketplace</a>
        <a href="/#calculator" class="hover:text-brandAccent">Calculator</a>
        <a href="/#hsfinder" class="hover:text-brandAccent">HS Finder</a>
        <a href="/#chat" class="hover:text-brandAccent">Chat</a>
        <a href="/#news" class="hover:text-brandAccent">News</a>
        <a href="/#learn" class="hover:text-brandAccent">Academy</a>
        <a href="/#pricing" class="hover:text-brandAccent">Pricing</a>
      </nav>
      <a href="/personal-sign-up.html" class="bg-brandAccent text-white px-4 py-2 rounded-lg hover:opacity-95">Sign up</a>
    </div>
  </header>

  <br><br><br>

  <!-- Hero -->
  <section class="pt-28 md:pt-32">
    <div class="hero-img">
      <div class="backdrop-brightness-50 bg-gradient-to-r from-brandPrimary/50 to-brandAccent/50">
        <div class="max-w-3xl mx-auto px-4 py-12 text-white text-center">
          <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">Create your free account</h1>
          <p class="mt-3 text-white/95">Unlock calculator results, HS suggestions, and chat history.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Centered card -->
  <main class="max-w-2xl mx-auto px-4 -mt-12">
    <div class="bg-white border border-brandBorder rounded-2xl shadow p-6 md:p-8">
      <form id="signupForm" class="grid gap-5">
        <div class="grid md:grid-cols-2 gap-5">
          <label class="grid gap-2 text-sm">
            <span class="font-medium">Full name</span>
            <input name="name" id="name" class="border border-brandBorder rounded-lg px-3 py-2 w-full" placeholder="Your name" required>
          </label>
          <label class="grid gap-2 text-sm">
            <span class="font-medium">Email</span>
            <input name="email" id="email" type="email" class="border border-brandBorder rounded-lg px-3 py-2 w-full" placeholder="you@example.com" required>
          </label>
        </div>

        <div class="grid md:grid-cols-2 gap-5">
          <label class="grid gap-2 text-sm">
            <span class="font-medium">Phone / WhatsApp (optional)</span>
            <input name="phone" id="phone" class="border border-brandBorder rounded-lg px-3 py-2 w-full" placeholder="+91 9xxxx xxxxx">
          </label>
          <label class="grid gap-2 text-sm">
            <span class="font-medium">Role</span>
            <select name="role" id="role" class="border border-brandBorder rounded-lg px-3 py-2 w-full">
              <option value="personal">Personal</option>
              <option value="business">Business</option>
              <option value="student">Student</option>
            </select>
          </label>
        </div>

        <!-- Password fields for Supabase auth -->
        <div class="grid md:grid-cols-2 gap-5">
          <label class="grid gap-2 text-sm">
            <span class="font-medium">Password</span>
            <input name="password" id="password" type="password" minlength="8" class="border border-brandBorder rounded-lg px-3 py-2 w-full" placeholder="8+ characters" required>
          </label>
          <label class="grid gap-2 text-sm">
            <span class="font-medium">Confirm password</span>
            <input name="confirm" id="confirm" type="password" minlength="8" class="border border-brandBorder rounded-lg px-3 py-2 w-full" placeholder="Re-enter password" required>
          </label>
        </div>

        <!-- Honeypot (spam trap) -->
        <input type="text" name="company" class="hidden" tabindex="-1" autocomplete="off">

        <button id="submitBtn" class="bg-brandAccent text-white px-5 py-2.5 rounded-lg text-base font-semibold" type="submit">
          Create account
        </button>

        <p id="msg" class="text-sm"></p>
        <p class="text-xs text-brandMuted">By signing up you agree to our Terms & Privacy.</p>
      </form>

      <div class="mt-6 text-sm text-center">
        <a href="/" class="text-brandAccent">‚Üê Back to home</a>
      </div>
    </div>
  </main>

  <footer class="text-center text-xs text-brandMuted mt-10 mb-8">
    ¬© <span id="year"></span> Chadaddy
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const form = document.getElementById('signupForm');
    const msgEl = document.getElementById('msg');
    const submitBtn = document.getElementById('submitBtn');

    function setMsg(text, ok=false){
      msgEl.textContent = text || '';
      msgEl.className = "text-sm " + (ok ? "text-green-600" : "text-red-600");
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      setMsg(""); submitBtn.disabled = true; submitBtn.textContent = "Creating...";

      const fd = new FormData(form);
      if ((fd.get('company') || '').trim() !== '') return; // bot trap

      const name  = (fd.get('name')  || '').trim();
      const email = (fd.get('email') || '').trim();
      const phone = (fd.get('phone') || '').trim();
      const role  = (fd.get('role')  || 'personal');
      const pass  = (fd.get('password') || '');
      const conf  = (fd.get('confirm')  || '');

      if (!name || !email) {
        setMsg("Please enter name and email");
        submitBtn.disabled = false; submitBtn.textContent = "Create account";
        return;
      }
      if (pass.length < 8) {
        setMsg("Password must be at least 8 characters");
        submitBtn.disabled = false; submitBtn.textContent = "Create account";
        return;
      }
      if (pass !== conf) {
        setMsg("Passwords do not match");
        submitBtn.disabled = false; submitBtn.textContent = "Create account";
        return;
      }

      // Create auth user
      const { data, error } = await supabase.auth.signUp({
        email,
        password: pass,
        options: { emailRedirectTo: `${location.origin}/dashboard.html` }
      });

      if (error) {
        setMsg(error.message || "Signup failed");
        submitBtn.disabled = false; submitBtn.textContent = "Create account";
        return;
      }

      // Optional profile row
      try {
        if (data.user) {
          await supabase.from('profiles').upsert({
            id: data.user.id,
            email,
            full_name: name,
            phone,
            role
          }, { onConflict: 'id' });
        }
      } catch (_) { /* ignore */ }

      setMsg("Account created. Check your email to verify.", true);
      submitBtn.disabled = false; submitBtn.textContent = "Create account";

      // If email confirmation is OFF, you may already be logged in:
      const { data: s } = await supabase.auth.getSession();
      if (s && s.session) {
        window.location.href = "/dashboard.html";
      }
    });
  </script>
</body>
</html>
